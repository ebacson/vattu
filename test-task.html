<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task Creation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 20px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>üß™ Test Task Creation</h1>
    
    <form id="testTaskForm">
        <div class="form-group">
            <label for="taskName">T√™n S·ª± V·ª• *</label>
            <input type="text" id="taskName" value="Test Task" required>
        </div>
        
        <div class="form-group">
            <label for="taskType">Lo·∫°i S·ª± V·ª• *</label>
            <select id="taskType" required>
                <option value="lapdat">L·∫Øp ƒë·∫∑t</option>
                <option value="xuly">X·ª≠ l√Ω</option>
                <option value="swap">Swap</option>
                <option value="nangcap">N√¢ng c·∫•p</option>
                <option value="baotri">B·∫£o tr√¨</option>
                <option value="khac">Kh√°c</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="taskDescription">M√¥ T·∫£ *</label>
            <textarea id="taskDescription" required>Test task description</textarea>
        </div>
        
        <div class="form-group">
            <label for="taskLocation">ƒê·ªãa ƒêi·ªÉm</label>
            <input type="text" id="taskLocation" value="Test Location">
        </div>
        
        <div class="form-group">
            <label for="taskPriority">∆Øu Ti√™n</label>
            <select id="taskPriority">
                <option value="low">Th·∫•p</option>
                <option value="medium" selected>Trung b√¨nh</option>
                <option value="high">Cao</option>
                <option value="urgent">Kh·∫©n c·∫•p</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="taskDeadline">H·∫°n Ho√†n Th√†nh</label>
            <input type="date" id="taskDeadline">
        </div>
        
        <button type="submit">T·∫°o S·ª± V·ª• Test</button>
    </form>
    
    <div id="result"></div>
    
    <h3>Debug Info:</h3>
    <div id="debug"></div>

    <script>
        // Mock data for testing
        let tasksData = [];
        let currentWarehouse = 'net';
        
        // Mock functions
        function getWarehouseName(warehouse) {
            return warehouse === 'net' ? 'Kho Net' : 'Kho H·∫° T·∫ßng';
        }
        
        function showResult(message, type) {
            const result = document.getElementById('result');
            result.innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        
        function addLog(type, action, details, user) {
            console.log('Log:', { type, action, details, user });
        }
        
        function updateDashboard() {
            console.log('Dashboard updated');
        }
        
        function renderTasksList() {
            console.log('Tasks list rendered');
        }
        
        function closeModal(modalId) {
            console.log('Modal closed:', modalId);
        }
        
        // Test task creation function
        async function handleTaskSubmit(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('taskName').value,
                type: document.getElementById('taskType').value,
                description: document.getElementById('taskDescription').value,
                location: document.getElementById('taskLocation').value,
                priority: document.getElementById('taskPriority').value,
                deadline: document.getElementById('taskDeadline').value ? new Date(document.getElementById('taskDeadline').value) : null
            };

            if (!formData.name || !formData.type || !formData.description) {
                showResult('‚ùå L·ªói! Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc.', 'error');
                return;
            }

            const newTask = {
                id: tasksData.length > 0 ? Math.max(...tasksData.map(t => t.id), 0) + 1 : 1,
                ...formData,
                status: 'pending',
                createdDate: new Date(),
                createdBy: getWarehouseName(currentWarehouse),
                assignedItems: [],
                completedItems: []
            };

            try {
                // Simulate Firebase save
                if (typeof window.saveTaskToFirebase === 'function') {
                    await window.saveTaskToFirebase(newTask);
                    showResult('‚úÖ T·∫°o s·ª± v·ª• th√†nh c√¥ng v√† l∆∞u v√†o Firebase!', 'success');
                } else {
                    showResult('‚ö†Ô∏è T·∫°o s·ª± v·ª• th√†nh c√¥ng (ch∆∞a l∆∞u Firebase - function kh√¥ng c√≥)', 'success');
                }
                
                // Update local data
                tasksData.push(newTask);
                addLog('task', 'T·∫°o s·ª± v·ª•', `T·∫°o s·ª± v·ª•: ${newTask.name}`, getWarehouseName(currentWarehouse));
                
                updateDashboard();
                renderTasksList();
                
                // Show debug info
                document.getElementById('debug').innerHTML = `
                    <p><strong>Task created:</strong></p>
                    <pre>${JSON.stringify(newTask, null, 2)}</pre>
                    <p><strong>Total tasks:</strong> ${tasksData.length}</p>
                `;
                
            } catch (error) {
                console.error('Error saving task:', error);
                showResult('‚ùå L·ªói! Kh√¥ng th·ªÉ l∆∞u s·ª± v·ª•: ' + error.message, 'error');
            }
        }
        
        // Add event listener
        document.getElementById('testTaskForm').addEventListener('submit', handleTaskSubmit);
        
        // Show initial debug info
        document.getElementById('debug').innerHTML = `
            <p><strong>Initial state:</strong></p>
            <p>Tasks data: ${tasksData.length} items</p>
            <p>Current warehouse: ${currentWarehouse}</p>
            <p>Firebase function available: ${typeof window.saveTaskToFirebase === 'function' ? 'Yes' : 'No'}</p>
        `;
    </script>
</body>
</html>
